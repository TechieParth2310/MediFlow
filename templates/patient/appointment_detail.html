{% extends "base.html" %}

{% block content %}

<div class="page-container">
    <div class="appointment-detail-container">
        <div class="detail-header-main">
            <h1>Appointment Details</h1>
            <span class="badge badge-{{ appointment.status }} badge-lg">{{ appointment.status.title() }}</span>
        </div>

        <!-- Appointment Information -->
        <div class="detail-card">
            <div class="detail-header">
                <h3>üìÖ Appointment Information</h3>
            </div>

            <div class="detail-grid">
                <div class="detail-item">
                    <label>Doctor</label>
                    <p>Dr. {{ appointment.doctor_name }}</p>
                </div>
                <div class="detail-item">
                    <label>Specialization</label>
                    <p>{{ appointment.specialization }}</p>
                </div>
                <div class="detail-item">
                    <label>Date</label>
                    <p>{{ appointment.appointment_date.strftime('%B %d, %Y') }}</p>
                </div>
                <div class="detail-item">
                    <label>Time</label>
                    <p>{{ appointment.appointment_time.strftime('%I:%M %p') }}</p>
                </div>
                {% if appointment.consultation_fee %}
                <div class="detail-item">
                    <label>Consultation Fee</label>
                    <p>${{ appointment.consultation_fee }}</p>
                </div>
                {% endif %}
                <div class="detail-item full-width">
                    <label>Reason for Visit</label>
                    <p>{{ appointment.reason_for_visit or 'General checkup' }}</p>
                </div>
                {% if appointment.symptoms %}
                <div class="detail-item full-width">
                    <label>Symptoms</label>
                    <p>{{ appointment.symptoms }}</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Medical Details (if available) -->
        {% if appointment.diagnosis or appointment.prescription or appointment.notes %}
        <div class="detail-card medical-records">
            <div class="detail-header">
                <h3>üíä Medical Records</h3>
            </div>

            {% if appointment.diagnosis %}
            <div class="medical-section">
                <label>Diagnosis</label>
                <p>{{ appointment.diagnosis }}</p>
            </div>
            {% endif %}

            {% if appointment.prescription %}
            <div class="medical-section">
                <label>Prescription</label>
                <p class="prescription-text">{{ appointment.prescription }}</p>
            </div>
            {% endif %}

            {% if appointment.notes %}
            <div class="medical-section">
                <label>Doctor's Notes</label>
                <p>{{ appointment.notes }}</p>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Actions -->
        <div class="action-buttons">
            <a href="{{ url_for('patient.appointments') }}" class="btn btn-secondary">Back to Appointments</a>

            {% if appointment.status in ['scheduled', 'confirmed'] %}
            <button type="button" class="btn btn-danger" onclick="showCancelModal()">Cancel Appointment</button>
            {% endif %}
        </div>
    </div>

    <!-- Cancel Modal -->
    {% if appointment.status in ['scheduled', 'confirmed'] %}
    <div id="cancelModal" class="modal" style="display:none;">
        <div class="modal-overlay" onclick="hideModal()"></div>
        <div class="modal-content">
            <h3>Cancel Appointment?</h3>
            <p>Are you sure you want to cancel this appointment?</p>
            <p class="warning-text">‚ö†Ô∏è You can only cancel at least 24 hours before the appointment.</p>

            <form method="POST" action="{{ url_for('patient.cancel_appointment', appointment_id=appointment.id) }}">
                <div class="input-box">
                    <label for="reason">Reason for Cancellation *</label>
                    <textarea name="reason" id="reason" rows="3" required
                        placeholder="Please provide a reason..."></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="hideModal()">No, Keep It</button>
                    <button type="submit" class="btn btn-danger">Yes, Cancel Appointment</button>
                </div>
            </form>
        </div>
    </div>
    {% endif %}
</div>

<script>
    function showCancelModal() {
        document.getElementById('cancelModal').style.display = 'flex';
    }

    function hideModal() {
        document.getElementById('cancelModal').style.display = 'none';
    }

    // Close modal on Escape key
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            hideModal();
        }
    });
</script>

{% endblock %}